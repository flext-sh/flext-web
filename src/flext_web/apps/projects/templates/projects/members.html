{% extends "base.html" %}

{% block title %}Manage Members for {{
project.display_name }} - FLEXT Meltano Enterprise{% endblock %}

{% block
content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
  <a
    href="{% url 'projects:detail' project.pk %}"
    class="text-indigo-600 hover:text-indigo-900 mb-4 inline-block"
    >&larr; Back to Project</a
  >
  <h1 class="text-3xl font-bold mb-2">Manage Team Members</h1>
  <p class="text-gray-500 mb-6">Project: {{ project.display_name }}</p>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <!-- Member List -->
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-xl font-bold mb-4">Current Members</h2>
      <ul class="divide-y divide-gray-200">
        {% for member in project.projectmembership_set.all %}
        <li class="py-3 flex justify-between items-center">
          <div>
            <p class="font-semibold">{{ member.user.username }}</p>
            <p class="text-sm text-gray-500">{{ member.user.email }}</p>
          </div>
          <div class="flex items-center">
            <span class="text-sm text-gray-700 mr-4"
              >{{ member.get_role_display }}</span
            >
            {% if is_owner %}
            <button class="text-red-500 hover:text-red-700">Remove</button>
            {% endif %}
          </div>
        </li>
        {% empty %}
        <li class="py-3">No members found.</li>
        {% endfor %}
      </ul>
    </div>

    <!-- Add Member Form -->
    {% if is_owner %}
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-xl font-bold mb-4">Add New Member</h2>
      <form method="post">
        {% csrf_token %}
        <div class="space-y-4">
          <div>
            <label
              for="user_email"
              class="block text-sm font-medium text-gray-700"
              >User Email</label
            >
            <input
              type="email"
              name="user_email"
              id="user_email"
              required
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
            />
          </div>
          <div>
            <label for="role" class="block text-sm font-medium text-gray-700"
              >Role</label
            >
            <select
              name="role"
              id="role"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
            >
              {% for role_value, role_name in roles %}
              <option value="{{ role_value }}">{{ role_name }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <button
              type="submit"
              class="w-full bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700"
            >
              Add Member
            </button>
          </div>
        </div>
      </form>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
